var invoiceEdit=function(e,t,o,n){var a,i;a=this,a.units=ko.observableArray();for(i in e)e.hasOwnProperty(i)&&a.units.push({slug:i,label:e[i]});a.taxes=ko.observableArray([{id:"",label:"No Tax - 0%"}]);for(i in t)t.hasOwnProperty(i)&&a.taxes.push({id:t[i].id,rate:t[i].rate,label:t[i].label+" - "+t[i].rate+"%"});a.items=ko.observableArray();for(i in o)o.hasOwnProperty(i)&&(o[i].quantity=ko.observable(o[i].quantity),o[i].unit_cost=ko.observable(o[i].unit_cost.formatted.replace(/[^\d.]/g,"")),null!==o[i].tax?o[i].tax_id=ko.observable(o[i].tax.id):o[i].tax_id=ko.observable(null),a.items.push(o[i]));a.state=ko.observable(""),a.dated=ko.observable(""),a.terms=ko.observable(""),a.addItem=function(){var e={id:null,quantity:ko.observable(1),unit:{id:""},label:"",body:"",unit_cost:ko.observable(null),tax_id:ko.observable(null)};a.items.push(e)},a.removeItem=function(){a.items.remove(this)},a.moveUp=function(){var e=a.items.indexOf(this);if(e>=1){var t=a.items();a.items.splice(e-1,2,t[e],t[e-1])}},a.moveDown=function(){var e=a.items().indexOf(this);if(e<a.items().length-1){var t=a.items();a.items.splice(e,2,t[e+1],t[e])}},a.submitText=ko.computed(function(){if("DRAFT"===a.state())return"Save Draft";var e=moment(a.dated(),"YYYY-MM-DD");return e.isAfter()?"Schedule to Send":"Send Now"}),a.submitClass=ko.computed(function(){if("DRAFT"===a.state())return"btn btn-primary";var e=moment(a.dated(),"YYYY-MM-DD");return e.isAfter()?"btn btn-warning":"btn btn-success"}),a.stateChanged=function(){a.state($("#invoice-state").val())},a.dateChanged=function(){a.dated($("#invoice-dated").val())},a.termsChanged=function(){a.terms(parseInt($("#invoice-terms").val(),10))},a.currencyChanged=function(e,t,o){var i=$("#invoice-currency").val(),r="",s="";for(var l in n)if(n.hasOwnProperty(l)&&n[l].code===i){"BEFORE"===n[l].symbol_position?(r=n[l].symbol,s=""):(r="",s=n[l].symbol);break}a.currencySymbolBefore(r),a.currencySymbolAfter(s)},a.termsText=function(){var e;if(a.terms()){var t=moment(a.dated(),"YYYY-MM-DD");if(!t.isValid())return'<b class="text-danger">Please select a valid date</b>';t.add(a.terms(),"d"),e=t.format("MMM Do, YYYY")}else e="receipt";return"Invoice will be due on <strong>"+e+"</strong>"},a.calculateSubTotal=ko.computed(function(){for(var e=0,t=a.items().length-1;t>=0;t--)e+=a.items()[t].quantity()*a.items()[t].unit_cost();return e}),a.calculateTax=ko.computed(function(){for(var e=0,t=a.items().length-1;t>=0;t--)if(a.items()[t].tax_id())for(var o=a.taxes().length-1;o>=0;o--)a.taxes()[o].id===a.items()[t].tax_id()&&(e+=a.items()[t].quantity()*a.items()[t].unit_cost()*(a.taxes()[o].rate/100));return e}),a.calculateGrandTotal=ko.computed(function(){var e=0;return e+=a.calculateSubTotal(),e+=a.calculateTax()}),a.currencySymbolBefore=ko.observable(),a.currencySymbolAfter=ko.observable(),a.save=function(){if("DRAFT"===a.state())return!0;var e=moment(a.dated(),"YYYY-MM-DD");return e.isAfter()?confirm("Save changes and Schedule the invoice to be sent on "+e.format("MMM Do, YYYY")+"?"):confirm("Save changes and send invoice now?")},a.preview=function(){$("<div>").html("Preview functionality coming soon.").dialog({title:"Work in Progress",resizable:!1,draggable:!1,modal:!0,buttons:{OK:function(){$(this).dialog("close")}}})},a.createCustomer=function(){$("<div>").html("You will lose unsaved changes.").dialog({title:"Are you sure?",resizable:!1,draggable:!1,modal:!0,dialogClass:"no-close",buttons:{OK:function(){window.location.href=window.SITE_URL+"admin/invoice/customer/create"},Cancel:function(){$(this).dialog("close")}}})},a.log=function(e,t){"function"==typeof console.log&&(void 0!==t?console.log("Invoice Edit:",e,t):console.log("Invoice Edit:",e))},a.warn=function(e,t){"function"==typeof console.warn&&(void 0!==t?console.warn("Invoire Edit:",e,t):console.warn("Invoire Edit:",e))}};null//# sourceMappingURL=invoice.edit.min.js.mapnull