var invoiceEdit=function(e,t,n){var o,a;o=this,o.units=ko.observableArray();for(a in e)e.hasOwnProperty(a)&&o.units.push({slug:a,label:e[a]});o.taxes=ko.observableArray([{id:"",label:"No Tax - 0%"}]);for(a in t)t.hasOwnProperty(a)&&o.taxes.push({id:t[a].id,rate:t[a].rate,label:t[a].label+" - "+t[a].rate+"%"});o.items=ko.observableArray();for(a in n)n.hasOwnProperty(a)&&(n[a].quantity=ko.observable(n[a].quantity),n[a].unit_cost=ko.observable(n[a].unit_cost.localised),null!==n[a].tax?n[a].tax_id=ko.observable(n[a].tax.id):n[a].tax_id=ko.observable(null),o.items.push(n[a]));o.state=ko.observable(""),o.dated=ko.observable(""),o.terms=ko.observable(""),o.addItem=function(){var e={id:null,quantity:ko.observable(1),unit:null,label:"",body:"",unit_cost:ko.observable(null),tax_id:ko.observable(null)};o.items.push(e)},o.removeItem=function(){o.items.remove(this)},o.moveUp=function(){var e=o.items.indexOf(this);if(e>=1){var t=o.items();o.items.splice(e-1,2,t[e],t[e-1])}},o.moveDown=function(){var e=o.items().indexOf(this);if(e<o.items().length-1){var t=o.items();o.items.splice(e,2,t[e+1],t[e])}},o.submitText=ko.computed(function(){if("DRAFT"===o.state())return"Save Draft";var e=moment(o.dated(),"YYYY-MM-DD");return e.isAfter()?"Schedule to Send":"Send Now"}),o.submitClass=ko.computed(function(){if("DRAFT"===o.state())return"btn btn-primary";var e=moment(o.dated(),"YYYY-MM-DD");return e.isAfter()?"btn btn-warning":"btn btn-success"}),o.stateChanged=function(){o.state($("#invoice-state").val())},o.dateChanged=function(){o.dated($("#invoice-dated").val())},o.termsChanged=function(){o.terms(parseInt($("#invoice-terms").val(),10))},o.termsText=function(){var e;if(o.terms()){var t=moment(o.dated(),"YYYY-MM-DD");if(!t.isValid())return'<b class="text-danger">Please select a valid date</b>';t.add(o.terms(),"d"),e=t.format("MMM Do, YYYY")}else e="receipt";return"Invoice will be due on <strong>"+e+"</strong>"},o.calculateSubTotal=ko.computed(function(){for(var e=0,t=o.items().length-1;t>=0;t--)e+=o.items()[t].quantity()*o.items()[t].unit_cost();return e}),o.calculateTax=ko.computed(function(){for(var e=0,t=o.items().length-1;t>=0;t--)if(o.items()[t].tax_id())for(var n=o.taxes().length-1;n>=0;n--)o.taxes()[n].id===o.items()[t].tax_id()&&(e+=o.items()[t].quantity()*o.items()[t].unit_cost()*(o.taxes()[n].rate/100));return e}),o.calculateGrandTotal=ko.computed(function(){var e=0;return e+=o.calculateSubTotal(),e+=o.calculateTax()}),o.save=function(){if("DRAFT"===o.state())return!0;var e=moment(o.dated(),"YYYY-MM-DD");return e.isAfter()?confirm("Save changes and Schedule the invoice to be sent on "+e.format("MMM Do, YYYY")+"?"):confirm("Save changes and send invoice now?")},o.preview=function(){$("<div>").html("Preview functionality coming soon.").dialog({title:"Work in Progress",resizable:!1,draggable:!1,modal:!0,buttons:{OK:function(){$(this).dialog("close")}}})},o.log=function(e,t){"function"==typeof console.log&&(void 0!==t?console.log("Invoice Edit:",e,t):console.log("Invoice Edit:",e))},o.warn=function(e,t){"function"==typeof console.warn&&(void 0!==t?console.warn("Invoire Edit:",e,t):console.warn("Invoire Edit:",e))}};
//# sourceMappingURL=invoice.edit.min.js.map
