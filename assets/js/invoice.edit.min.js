var invoiceEdit=function(e,t,o){var n,i;n=this,n.units=ko.observableArray();for(i in e)e.hasOwnProperty(i)&&n.units.push({slug:i,label:e[i]});n.taxes=ko.observableArray([{id:"",label:"No Tax - 0%"}]);for(i in t)t.hasOwnProperty(i)&&n.taxes.push({id:t[i].id,rate:t[i].rate,label:t[i].label+" - "+t[i].rate+"%"});n.items=ko.observableArray();for(i in o)o.hasOwnProperty(i)&&(o[i].quantity=ko.observable(o[i].quantity),o[i].unit_cost=ko.observable(o[i].unit_cost.localised),null!==o[i].tax?o[i].tax_id=ko.observable(o[i].tax.id):o[i].tax_id=ko.observable(null),n.items.push(o[i]));n.state=ko.observable(""),n.dated=ko.observable(""),n.terms=ko.observable(""),n.addItem=function(){var e={id:null,quantity:ko.observable(1),unit:{id:""},label:"",body:"",unit_cost:ko.observable(null),tax_id:ko.observable(null)};n.items.push(e)},n.removeItem=function(){n.items.remove(this)},n.moveUp=function(){var e=n.items.indexOf(this);if(e>=1){var t=n.items();n.items.splice(e-1,2,t[e],t[e-1])}},n.moveDown=function(){var e=n.items().indexOf(this);if(e<n.items().length-1){var t=n.items();n.items.splice(e,2,t[e+1],t[e])}},n.submitText=ko.computed(function(){if("DRAFT"===n.state())return"Save Draft";var e=moment(n.dated(),"YYYY-MM-DD");return e.isAfter()?"Schedule to Send":"Send Now"}),n.submitClass=ko.computed(function(){if("DRAFT"===n.state())return"btn btn-primary";var e=moment(n.dated(),"YYYY-MM-DD");return e.isAfter()?"btn btn-warning":"btn btn-success"}),n.stateChanged=function(){n.state($("#invoice-state").val())},n.dateChanged=function(){n.dated($("#invoice-dated").val())},n.termsChanged=function(){n.terms(parseInt($("#invoice-terms").val(),10))},n.termsText=function(){var e;if(n.terms()){var t=moment(n.dated(),"YYYY-MM-DD");if(!t.isValid())return'<b class="text-danger">Please select a valid date</b>';t.add(n.terms(),"d"),e=t.format("MMM Do, YYYY")}else e="receipt";return"Invoice will be due on <strong>"+e+"</strong>"},n.calculateSubTotal=ko.computed(function(){for(var e=0,t=n.items().length-1;t>=0;t--)e+=n.items()[t].quantity()*n.items()[t].unit_cost();return e}),n.calculateTax=ko.computed(function(){for(var e=0,t=n.items().length-1;t>=0;t--)if(n.items()[t].tax_id())for(var o=n.taxes().length-1;o>=0;o--)n.taxes()[o].id===n.items()[t].tax_id()&&(e+=n.items()[t].quantity()*n.items()[t].unit_cost()*(n.taxes()[o].rate/100));return e}),n.calculateGrandTotal=ko.computed(function(){var e=0;return e+=n.calculateSubTotal(),e+=n.calculateTax()}),n.save=function(){if("DRAFT"===n.state())return!0;var e=moment(n.dated(),"YYYY-MM-DD");return e.isAfter()?confirm("Save changes and Schedule the invoice to be sent on "+e.format("MMM Do, YYYY")+"?"):confirm("Save changes and send invoice now?")},n.preview=function(){$("<div>").html("Preview functionality coming soon.").dialog({title:"Work in Progress",resizable:!1,draggable:!1,modal:!0,buttons:{OK:function(){$(this).dialog("close")}}})},n.createCustomer=function(){$("<div>").html("You will lose unsaved changes.").dialog({title:"Are you sure?",resizable:!1,draggable:!1,modal:!0,dialogClass:"no-close",buttons:{OK:function(){window.location.href=window.SITE_URL+"admin/invoice/customer/create"},Cancel:function(){$(this).dialog("close")}}})},n.log=function(e,t){"function"==typeof console.log&&(void 0!==t?console.log("Invoice Edit:",e,t):console.log("Invoice Edit:",e))},n.warn=function(e,t){"function"==typeof console.warn&&(void 0!==t?console.warn("Invoire Edit:",e,t):console.warn("Invoire Edit:",e))}};
//# sourceMappingURL=invoice.edit.min.js.map
